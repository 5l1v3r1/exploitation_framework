import npyscreen,importlib,glob,json

module_list = []
class item:
    def __init__(self, p_filename):
        self.filename = p_filename
        self.mod_path = ""
        self.name = ""
        self.button_name = ""
        self.load_from_file()


    def load_from_file(self):
        with open(self.filename, 'r') as loader:
            data = loader.readline()
            x = json.loads(str(data))
            self.mod_path = x["lib"]
            self.name = x["name"]
            self.button_name = x["button_name"]
def loadMods():
    pattern = "./modules/**/*.json"

    filelist = glob.glob(pattern, recursive=True)
    for fn in filelist:
        temp_obj = item(fn)
        module_list.append(temp_obj)
loadMods()

class MyTestApp(npyscreen.NPSAppManaged):
    def onStart(self):
        self.addForm("MAIN",       MainForm, name="Main", color="IMPORTANT",)
        for i in module_list:
          module_name = i.mod_path
          module_plugin = importlib.import_module(module_name, ".")
          self.addForm(i.name,     module_plugin.Form, name=i.name, color="IMPORTANT",  )

    def onCleanExit(self):
        npyscreen.notify_confirm("Goodbye!")

    def change_form(self, name):
        self.switchForm(name)
        self.resetHistory()
class MainForm(npyscreen.ActionForm):
    def create(self):
      for i in module_list:
          module_name = i.mod_path
          module_plugin = importlib.import_module(module_name, ".")
          self.button = self.add(module_plugin.Button, name = i.button_name)

    def on_ok(self):
        # Exit the application if the OK button is pressed.
        self.parentApp.switchForm(None)
def main():
    TA = MyTestApp()
    TA.run()
if __name__ == '__main__':
    main()


